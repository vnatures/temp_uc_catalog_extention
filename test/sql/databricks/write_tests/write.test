# name: test/sql/databricks/write_tests/write.test
# description: test
# group: [write_tests]

# Require statement will ensure this test is run with this extension loaded
require parquet

require unity_catalog

require delta

require httpfs

require-env DATABRICKS_TOKEN

require-env DATABRICKS_ENDPOINT

require-env DATABRICKS_REGION

require-env DATABRICKS_WRITE_TEST_CATALOG

require-env DATABRICKS_WRITE_TEST_SCHEMA

statement ok
CREATE SECRET (
    TYPE UC,
    TOKEN '${DATABRICKS_TOKEN}',
    ENDPOINT '${DATABRICKS_ENDPOINT}',
    AWS_REGION '${DATABRICKS_REGION}'
);

# Attach to databricks through the unity catalog API
statement ok
ATTACH '${DATABRICKS_WRITE_TEST_CATALOG}' as databricks_catalog (TYPE UNITY_CATALOG, DEFAULT_SCHEMA '${DATABRICKS_WRITE_TEST_SCHEMA}');

statement ok
USE databricks_catalog;

query I
select sum(l_orderkey) from lineitem
----
1802759573

statement ok
FROM lineitem limit 5

statement ok
INSERT INTO lineitem VALUES (1, 241, 23, 5, 24.00, 27389.76, 0.10, 0.04, 'N', 'O', '1996-03-30', '1996-03-14', '1996-04-01', NULL, 'FOB', 'the regular, regular pa');

query I
select sum(l_orderkey) from lineitem
----
1802759574
